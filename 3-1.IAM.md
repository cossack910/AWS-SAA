# IAM

| 主要要素             | 説明                                                                                                                                   |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| IAM ポリシー         | ユーザーなどへのアクセス権限を付与するための設定ドキュメントのこと                                                                     |
| IAM ユーザー         | AWS アカウント内の利用ユーザー<br>AWS 上の利用者は IAM ユーザーという権限の付与されたエンティティとして設定される                      |
| IAM ユーザーグループ | グループとしてまとめて権限を付与する仕組み<br>グループには複数の IAM ユーザーが設定される                                              |
| IAM ロール           | ASW リソースが別のリソースに対するアクセス権限を付与する仕組み<br>別の AWS アカウントの IAM ユーザーのアクセス権限を委譲する際にも利用 |

## IAM ユーザー

- ルートユーザー

  - AWS アカウント作成時に作られる ID アカウント
  - 全ての AWS サービスとリソースを使用出来る
  - **日常タスクでは使用しないことを推奨**

- 管理者権限ユーザー

  - 管理者権限の許可が付与された IAM ユーザー
  - IAM の操作権限あり
  - ルートアカウントしかできない権限は付与されない

- パワーユーザー
  - IAM 以外の AWS サービスにアクセス権限を有する IAM ユーザー
  - IAM の操作権限はなし

## IAM 用語

| 用語                 | 　説明　                                                                                                                                |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| IAM リソース         | IAM で保存・管理されるユーザー、グループ、ロール、ポリシー、及び ID プロバイダー                                                        |
| IAM アイデンティティ | ユーザー、グループ及びロール<br>AWS で認証されてグループ化に使用される IAM リソースオブジェクトのこと                                   |
| IAM エンティティ     | ユーザー及びロール<br>AWS に認証される IAM リソースオブジェクト                                                                         |
| プリンシパル         | ルートユーザー、IAM ユーザー、または IAM ロールを使用する人またはアプリケーション<br>フェーデレットユーザーと引き受けたロールも含まれる |

## IAM ポリシーのタイプ

| ポリシー           | 説明                                                                                                                                                                                                                                                                                                  |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 管理者ポリシー     | 【AWS 管理者ポリシー】<br>AWS が作成及び管理している IAM 管理ポリシー既に AWS が設定しているポリシーがリスト化されており、適時ユーザーやロールに適用出来る<br><br>【カスタマー管理ポリシー】<br>AWS アカウントで作成・管理する管理ポリシー。<br>同じポリシーを複数の IAM エンティティにアタッチできる |
| インラインポリシー | 1 つのプリンシパルエンティティに（ユーザー、グループ、またはロール）に埋め込まれた固有ポリシーで、プリンシパルエンティティにアタッチできる                                                                                                                                                            |

**管理ポリシー**

```
通常は管理ポリシーを使用する。AWS管理ポリシーを優先して利用する。
必要ならばカスタマーポリシーを作成する。

1つのユーザーやリソースに使い回せる。
```

**インラインポリシー**

```
特定ユーザーやリソースに組み込まれているため使いまわせない。
```

## ポリシーのタイプ

| タイプ         | 説明                                                                                                                                                                                                                                 |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ユーザーベース | IAM アイデンティティ(ユーザー、ユーザーのグループ、ロール)にアタッチされるポリシー<br>管理ポリシーやインラインポリシなどをさす<br>ユーザー、ユーザーのグループ、ロールが実行できる許可を指定できる                                   |
| リソースベース | AWS リソースにアタッチされるポリシー、リソースに対するアクセス権限設定を実行する<br>S3 のバケットポリシー、ロールの信頼ポリシーが該当する<br>json 形式のドキュメントで定義されたインラインポリシーをリソースにアタッチして利用する。 |

## ポリシー効果

| 効果         | 説明                                                                                                                                                             |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 許可ポリシー | AWS リソースへのアクセス許可・拒否を設定する通常 IAM ポリシーのこと<br>許可するアクション範囲を設定する                                                          |
| 信頼ポリシー | 特定ユーザーやリソースへのアクセスを許すための前提となる信頼を形成するためのポリシー<br>信頼ポリシーが付与されているロールに基づいて、権限を以上することができる |

**tips**
信頼ポリシーは一時的な権限を委譲する時にも利用される
第３者による監査の時などに一時的に付与する。

## IAM 権限のベストプラクティス(一部抜粋)

- 多要素認証(MFA)認証が必要
- 最小と嫌悪アクセス許可を適用する
- IAM アクセスアナライザーを使用して IAM ポリシーの検証。安全で機能的なアクセス許可を確保する
