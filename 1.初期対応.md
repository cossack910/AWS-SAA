# AWWS 推奨の認証(セキュリティ向上)

## 1,MFA(多要素認証) の有効化

- google Authenticator を使用

## 2,管理者用の IAM ユーザー作成

#### １ IAM ユーザーを新規作成して、管理者権限を付与

以下全てチェック

**IAM を作成**

- [ ] 入力項目
- AWS マネジメントコンソールへのユーザーアクセスを提供する

  - IAM ユーザーを作成します
  - パスワード自動生成を選択
  - ユーザーは次回のサインイン時に新しいパスワードを作成する必要があります - 推奨・有効

- 許可設定

  - ポリシーを直接アタッチする
  - AdministoratorAccess を許可

- 確認して作成
  - タグとキーを設定する。

#### ２ IAM グループを新規作成してグループを通して管理者権限付与

**ユーザーグループを作成**

- [ ] 入力項目
- グループに名前を付ける
  - わかりやすい名前をつける
- ユーザーをグループに追加 - オプション
  - 1 で作成した管理者ユーザーをチェック
    - **IAM 作成時に付与した権限とグループで管理者権限が重複しているため個別付与のポリシーは削除する**
- 許可ポリシーを添付 - オプション
  - AdministratorAccess にチェックを入れグループ全体に管理者権限を付与する

## 3 AWS CloudTrail を有効果

CloudTrail によりユーザーのアクセスログを取得・監視することができる。

<br>

**クイック証跡の作成**

- [ ] 入力項目
- 証跡名
- S3 のバケットは自動で入力してくれる

**証跡の作成**

Cloudtail -> ダッシュボードから<br>

証跡属性の選択

- [ ] 入力項目
- 証跡名
  - わかりやすい名前をつける
- ストレージの場所
  - S3 バケット新規作成
- 証跡ログバケットおよびフォルダ
  - 自動生成されてる
- ログファイルの SSE-KMS 暗号化
  - 無効(後で有効化する)
- SNS 通知の配信
  - 無効
- CloudWatch Logs
  - 無効
- タグ
- 設定なし

次へ->ログイベントの選択

- [ ] 入力項目
- イベント

  - 管理イベント・有効
  - データイベント・無効(あったほうがいいお金がかかる)
  - insights・無効(あったほうがいいお金がかかる)

- 管理イベント
  - 読み取り・有効
  - 書き込み・有効
  - AWS KMS イベントの除外・無効
  - Amazon RDS のデータ API イベントを除外・無効

Cloud tail->イベント履歴で実行履歴を確認できる
Athena に S3 を吐き出してクエリ解析もできる。
Cloud trail 自体もレイクで解析可能

## 4 AWS の請求アラートを有効化

root ユーザーで設定

#### 初期設定

Billing and Cost Management クリック

請求とコスト管理->請求設定

- [ ] 入力項目
- 請求アラート編集
  - AWS 無料利用枠アラートを受信する・有効化(デフォルト)
    - アラートを受け取るメールアドレスを設定する
  - CloudWatch 請求アラートを受信する・有効化

#### CloudWatch を使用して請求アラートを設定する

**tips**
東京リージョンで設定不可。はバージニア北部リージョンで設定

CloundWatch->アラーム

- [ ] 入力項目
  - アラームの作成

CloudWatch->アラーム->アラームの作成

- [ ] 入力項目

- メトリクス

  - メトリクス名
    - わかりやすい名前(デフォルトでも良い)
  - Currency
    - JP(日本円)
  - 統計(集計の表示方法)
    - 平均値
  - 期間(設定時間ごとに集計する)
    - ６時間(デフォルト)

- 条件
  - しきい値の種類
    - 静的
  - EstimatedCharges が次の時...
    - 以上
  - ... よりも
    - 1000

↑ 請求額が 1000 円 以上の時、アラームを通知する設定

次へ->アクションの設定

請求アラートの通知のみなので lambda や AutoScaling の設定は今回はしない

- [ ] 入力項目
- 通知
  - アラーム状態トリガー
    - アラーム状態
  - 次の SNS トピックに通知を送信
    - 新しいトピックの作成
  - 新規トピックの作成中...
    - デフォルトのやつ
  - 通知を受け取る E メールエンドポイント …
    - 通知を受け取るメールアドレス

次へ -> 名前と説明を追加

- [ ] 入力項目
  - アラーム名
    - わかりやすい名前

次へ->プレビューを確認してアラームを作成
